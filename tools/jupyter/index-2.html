<meta charset="utf-8">

<oda-jupyter-app></oda-jupyter-app>

<script type="module">
    import '../../oda.js';
    ODA({ is: 'oda-jupyter-app', imports: '@oda/button, ./jupyter.js',
        template: `
            <style>
                oda-button {
                    font-size: 12px;
                    margin: 2px;
                }
            </style>

            <div style="flex-wrap: wrap; display: flex; flex-direction: row-reverse; border: 1px solid gray; position: sticky; top: 0; background: white; z-index: 99; background: lightgray; margin: 1px">
                <oda-button @tap="saveFile">save</oda-button>
                <oda-button for="load" @tap="this.$('#load').click()">load</oda-button>
                <input id="load" type="file" style="display: none" @change="loadFile($event)"/>
                <oda-button @tap="jupyter.readOnly = !jupyter.readOnly" allow-toggle ::toggled="jupyter.readOnly">readOnly</oda-button>
                <oda-button @tap="clear">clear</oda-button>
                <oda-button @tap="document.location.reload()">reload</oda-button>
            </div>
            <oda-jupyter id="jupyter" :src show-border></oda-jupyter>
        `,
        src: './jupyter-2.json',
        get jupyter() { return this.$('#jupyter') },
        loadFile(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = async e => this.jupyter.notebook = JSON.parse(e.target.result);
            reader.readAsText(file, 'UTF-8');
            if (this.jupyter.notebook) {
                this.readOnly = this.jupyter.notebook.readOnly;
            }
        },
        async saveFile(e) {
            let str = JSON.stringify(this.jupyter.notebook, null, '\t');
            if (!str) return;
            const blob = new Blob([str], { type: "text/plain" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = (this.jupyter.notebook.label || 'oda-jupyter') + '.json';
            a.click();
        },
        clear() {
            if (window.confirm(`Do you really want delete current cell ?`)) {
                this.jupyter.notebook.cells = [];
            }
        }
    })
</script>