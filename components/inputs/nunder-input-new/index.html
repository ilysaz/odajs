<meta charset="UTF-8">
<oda-number></oda-number>
<script type="module">
    import  '/web/oda/oda.js';
    ODA({is:'oda-number',
        template:`
            <style>
                :host{
                    @apply --vertical;
                }
                input{
                    text-align: right;
                    width: 200px;
                    margin: 16px;
                }
                div{
                    align-items: center;
                }
            </style>
            <span>value: {{value}}</span>
            <span>mask:<input ::value="mask"></span>
            <div class="horizontal">
                <input @input="onInput" :value="maskedValue">
            </div>
        `,
        mask: '# #.000',
        value: [],
        get rounding () {
            return /0/.test(this.mask) ? this.mask.match(/(?<=\.)\d+/) ? this.mask.match(/(?<=\.)\d+/)[0].length : 0 : 0;
        },
        get maskedValue () {
            return (+this.value.join('')).toFixed(this.rounding).replace(/(?=(\d{3})+(?!\d)(?=\.))/g, " ");
        },
        onInput(e){
            const char = e.data;
            const start = e.target.selectionStart;
            const end = e.target.selectionEnd;
            switch (e.inputType) {
                case 'insertText': {
                    /\d|\./.test(char) ? this.value.splice(start-1, 0, char) : false;
                } break;
                case 'deleteContentBackward': {
                    this.value[start-1] === '.' ? this.value.splice(start-2, 2) : this.value.splice(start-1, 1);
                    e.target.setSelectionRange(start, end);
                } break;
                case 'deleteContentForward': {
                    this.value.splice(start, 1);
                } break;
            }
            this.maskedValue = undefined;
        }
    })
</script>